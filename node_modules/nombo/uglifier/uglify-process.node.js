var uglify = require('uglify-js');

var handleError = function (err) {
	var error;
	if (err.stack) {
		error = {
			message: err.message,
			stack: err.stack
		}
	} else {
		error = err;
	}
	process.send({type: 'error', data: error});
};

var options = {
	fromString: true,
	mangle: true
};

process.on('message', function (m) {
	if (m.type == 'init') {
		if (m.data.mangle != null) {
			options.mangle = m.data.mangle;
		}
	} else if (m.type == 'minify') {
		var result = uglify.minify(m.data, options).code;
		process.send({type: 'result', id: m.id, data: result});
	}
});