var fs = require('fs'),
	path = require('path');

var Responder = new (function () {
	var self = this;
	
	self.run = function (req, res, next) {
		if (req.rout.buffer !== null || req.rout.error) {
			if (req.rout.error && !req.rout.hasOwnProperty('status')) {
				res.writeHead(500);
			} else {
				res.writeHead(req.rout.status || 200);
			}
			if (req.rout.buffer) {
				res.end(req.rout.buffer);
			} else {
				res.end();
			}
		} else {
			res.writeHead(200);
			req.rout.getLastStream().pipe(res);
		}
	};
})();

module.exports = Responder;
